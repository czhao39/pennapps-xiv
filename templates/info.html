{% extends "layout.html" %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="/css/info.css">
    <script type="text/javascript" src="/js/jquery.timeago.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        $(".timeago").timeago();
    });
    </script>
{% endblock %}

{% block content %}
    {{ super() }}
    <div class="row">
        <div class="col s12 m12 l6"><img class="property-img" src="https://maps.googleapis.com/maps/api/streetview?location={{ lat }},{{ lng }}&size=350x300&key={{ mapkey }}" alt="property image"></div>
        <div class="col s12 m12 l6"><iframe class="map" src="https://www.google.com/maps/embed/v1/place?q=place_id:{{ place_id }}&key={{ mapkey }}" allowfullscreen></iframe></div>
    </div>
    <div class="card white overview">
        <div class="card-content" style="position: relative">
            <span class="card-title">Overview</span>
            {% if overview %}
            <div class="row">
                <ul class="col s12 m12 l6">
                    <li><strong>{{ overview.address.street }}<br>{{ overview.address.city }}, {{ overview.address.state }} {{ overview.address.zipcode }}</strong></li>
                    <li><strong>{{ overview.bedrooms }} beds&ensp;-&ensp;{{ overview.bathrooms }} baths&ensp;-&ensp;{{ overview.sqft }} ft<sup>2</sup></strong></li>
                </ul>
                <ul class="col s12 m12 l6">
                    <li><strong>Zestimate<sup>&reg;</sup>:</strong>&ensp;{{ overview.zestimate|format_money }}</li>
                    <li><strong>Built:</strong>&ensp;{{ overview.built }}{% if overview.built %} ({{ current_year - overview.built }} years ago){% endif %}</li>
                    <li><strong>Last Sold:</strong>&ensp;{{ overview.lastSold }}</li>
                    <li></li>
                </ul>
            </div>
            <a href="{{ overview.zillow }}" target="_blank">More details on Zillow</a>
            <img src="img/zillow.png" title="Provided by Zillow" class="zillow-img" />
            {% else %}
            <p>We were not able to find any information about this building on Zillow.</p>
            {% endif %}
        </div>
    </div>
    <div class="card white overview">
        <div class="card-content">
            <span class="card-title">Schools</span>
            {% if schools %}
                <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Grade</th>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody>
                {% for school in schools %}
                <tr>
                    <td>{{ school.grade }}</td><td>{{ school.name }}</td>
                </tr>
                {% endfor %}
                </tbody>
                </table>
            {% else %}
            <p>No schools were found in this area.</p>
            {% endif %}
        </div>
    </div>
    <div class="card white">
        <div class="card-content">
            <span class="card-title">Public Services</span>
            {% if services|length > 0 %}
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>Distance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in services|crop_list %}
                    <tr>
                        {% if item.type == "hospital" %}
                        <td><i class="tiny material-icons">local_hospital</i>&ensp;Hospital</td>
                        {% elif item.type == "library" %}
                        <td><i class="tiny material-icons">book</i>&ensp;Public Library</td>
                        {% elif item.type == "book_store" %}
                        <td><i class="tiny material-icons">book</i>&ensp;Book Store</td>
                        {% elif item.type == "post_office" %}
                        <td><i class="tiny material-icons">email</i>&ensp;Post Office</td>
                        {% else %}
                        <td>{{ item.type|title }}</td>
                        {% endif %}
                        <td>{{ item.name }}</td>
                        <td>{{ item.dist|round(1) }} mi</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>There are no public services in this area.</p>
            {% endif %}
        </div>
    </div>
    <div class="card white">
        <div class="card-content">
            <span class="card-title">Public Transportation</span>
            {% if transportation|length > 0 %}
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>Distance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in transportation|crop_list %}
                    <tr>
                        {% if item.type == "bus_station" %}
                        <td><i class="tiny material-icons">directions_bus</i>&ensp;Bus Stop</td>
                        {% elif item.type == "subway_station" %}
                        <td><i class="tiny material-icons">train</i>&ensp;Subway Station</td>
                        {% else %}
                        <td>{{ item.type|title }}</td>
                        {% endif %}
                        <td>{{ item.name }}</td>
                        <td>{{ item.dist|round(1) }} mi</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>There are no bus stops or subway stations in this area.</p>
            {% endif %}
        </div>
    </div>
    <div class="card white">
        <div class="card-content">
            <span class="card-title">Crimes and Accidents</span>
            {% if crimes|length > 0 %}
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Time</th>
                        <th>Distance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in crimes|crop_list %}
                    <tr>
                        <td>{% if item.car %}<i class="tiny material-icons">directions_car</i> {% endif %}{{ item.type }}</td>
                        <td class="timeago" title="{{ item.time }}">{{ item.time|format_date }}</td>
                        <td>{{ item.dist|round(1) }} mi</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>There are no recent reports of crimes in this area.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
